#!/bin/bash -e

OS=$(uname -s)
MACH=$(uname -m)

DOGMA_BIN="$(dirname "$0")/native"

if [[ "${OS}" == 'Darwin' ]]; then
  if [[ "${MACH}" == 'x86_64' ]]; then
    DOGMA_BIN="${DOGMA_BIN}/dogma.darwin_amd64"
  elif [[ "${MACH}" == 'arm64' ]]; then
    DOGMA_BIN="${DOGMA_BIN}/dogma.darwin_arm64"
  else
    echo "Architecture not supported by default: ${OS}-${MACH}"
    exit 1
  fi
elif [[ "${OS}" == 'Linux' ]]; then
  if [[ "${MACH}" == 'x86_64' ]]; then
    DOGMA_BIN="${DOGMA_BIN}/dogma.linux_amd64"
  elif [[ "${MACH}" == 'aarch64' ]]; then
    DOGMA_BIN="${DOGMA_BIN}/dogma.linux_arm64"
  else
    echo "Architecture not supported by default: ${OS}-${MACH}"
    exit 1
  fi
else
  echo "OS not supported: ${OS}-${MACH}"
  exit 1
fi

exec "$DOGMA_BIN" "$@"
